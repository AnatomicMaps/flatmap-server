==============
Flatmap Server
==============

An anatomical flatmap server to provide `Mapbox <https://www.mapbox.com/>`_ compatible tilesets generated by `flatmap-maker <https://github.com/dbrnz/flatmap-maker>`_. It is intended for use with a browser-based `flatmap-viewer <https://github.com/ABI-Software/flatmap-viewer>`_ application. The server is written in Python using the `Flask <https://flask.palletsprojects.com/en/1.1.x/>`_ web framework.

Requirements
============

* Python 3.8
* `pipenv <https://pypi.org/project/pipenv/>`_


Installation
============

1) Download the `latest release <https://github.com/dbrnz/flatmap-server/releases/latest>`_ and extract it to a suitable directory.
2) Change to this directory and run ``pipenv install``.


Running
=======

::

    $ pipenv run gunicorn src.server:app


* By default, maps are stored in ``./flatmaps``. This can be overridden by setting the ``FLATMAP_ROOT`` environment variable to a directory path.
* The server listens at ``http://127.0.0.1:8000``. Change this via `Gunicorn <https://docs.gunicorn.org/en/stable/settings.html>`_.

Map making
==========


Map viewer
==========

Requires ``node`` and ``npm``.

In the top-level server directory::

    $ git clone https://github.com/dbrnz/flatmap-server-viewer viewer
    $ cd viewer
    $ npm install
    $ npm run build
    $ cd ..


Run the server with integrated viewer::

    $ pipenv run gunicorn src.server:viewer
